<app-navbar></app-navbar>
<div class="container mx-auto p-6 bg-fixed bg-center bg-cover" style="background-image: url('assets/images/3.png');">
    <div class="flex flex-wrap -mx-3">
      <!-- Formulaire -->
      <div  class="w-full lg:w-1/3 px-3 mb-6 lg:mb-0">
        <div class="bg-white bg-opacity-30 p-6 rounded-lg shadow-md">
          <h2 class="text-2xl font-bold mb-4">{{ panneEdit ? 'Modifier' : 'Ajouter' }} une panne</h2>
          <form [formGroup]="addPanneForm" (ngSubmit)="onSubmit()">
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="moto">Moto</label>
              <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="moto" name="moto" formControlName="moto">
                <option *ngFor="let moto of motos" [value]="moto.id">{{ moto.numero_serie }}</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="description">Description</label>
              <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="description" name="description" formControlName="description"></textarea>
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="date_signalement">Date de signalement</label>
              <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="date_signalement" name="date_signalement" type="date" formControlName="date_signalement">
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="etat">État</label>
              <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="etat" name="etat" formControlName="etat">
                <option value="non_corrigee">Non corrigée</option>etat
                <option value="corrigee">Corrigée</option>
              </select>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="created_by">Crée par</label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="created_by" name="created_by" formControlName="created_by">
                  <option *ngFor="let admMag of adminManegr" [value]="admMag.id">{{ admMag.username }}</option>
                </select>
              </div>
              <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="modified_by">Modifié par</label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="modified_by" name="modified_by" formControlName="modified_by">
                  <option *ngFor="let admMag of adminManegr" [value]="admMag.id">{{ admMag.username }}</option>
                </select>
              </div>
            <div *ngIf="utilisateur?.type_utilisateur === 'admin' || utilisateur?.type_utilisateur === 'manager'" class="flex items-center justify-between">
              <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">{{ panneEdit ? 'Mettre à jour' : 'Ajouter' }}</button>
            </div>
          </form>
        </div>
      </div>
  
      <!-- Tableau des pannes -->
      <div class="w-full lg:w-2/3 px-3">
        <div class="bg-white bg-opacity-30 p-6 rounded-lg shadow-md overflow-x-auto">
          <h2 class="text-2xl font-bold mb-4">Liste des pannes</h2>
          <table class="min-w-full leading-normal">
            <thead>
              <tr>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">N°</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Moto</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Description</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Date de signalement</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">État</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Crée par</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Modifié par</th>
                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/6">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let panne of pannes | paginate: { itemsPerPage: itemsPerPage, currentPage: p }; let i = index">
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{(p - 1) * itemsPerPage + i + 1 }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ getMotoById(panne.moto)?.numero_serie }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ panne.description }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ panne.date_signalement }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ panne.etat }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ getUserById(panne.created_by)?.username }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">{{ getUserById(panne.modified_by)?.username }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm w-1/6">
                  <button *ngIf="utilisateur?.type_utilisateur === 'admin' || utilisateur?.type_utilisateur === 'manager'" class="text-blue-600 hover:text-blue-900" (click)="editPanne(panne)">Modifier</button>
                  <button *ngIf="utilisateur?.type_utilisateur === 'admin' || utilisateur?.type_utilisateur === 'manager'" class="text-red-600 hover:text-red-900 ml-4" (click)="deletePanne(panne.id)">Supprimer</button>
                </td>
              </tr>
            </tbody>
          </table>
          <pagination-controls (pageChange)="p = $event"></pagination-controls>
        </div>
      </div>
    </div>
  </div>
  